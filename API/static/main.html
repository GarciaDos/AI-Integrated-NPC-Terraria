<!DOCTYPE html>
<html lang="en">
<head>
  <style>
  .typewriter{
  overflow: hidden; /* Ensures the content is not revealed until the animation */
  border-right: .15em solid #ffa500; /* The typwriter cursor */
  margin: 0 auto; /* Gives that scrolling effect as the typing happens */
  letter-spacing: .15em; /* Adjust as needed */
  animation: 
    typing 3.5s steps(40, end),
    blink-caret .75s step-end infinite;

  
}

/* The typing effect */
@keyframes typing {
  from { width: 0 }
  to { width: 100% }
}

/* The typewriter cursor effect */
@keyframes blink-caret {
  from, to { border-color: transparent }
  50% { border-color: orange; }
}
  </style>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NPC Interaction</title>
  <link rel="stylesheet" href="/static/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
</head>
<body style="background-image: url('/static/bg2.png');">
  <div class="container">
    


    <div class="npc-box" id="npcBox">
      <span id="npcName">Ophelia-Bot</span><br>
      <span class="typewriter" id="npcText">Hello Traveller, What do you seek today?</span>
    </div>
    <div class="npc-box" id="npcintentBox">
      <span id="npcName">Intent</span><br>
    </div>
    <div class = "input-box">
      <input type="text" id="questionInput" placeholder="Enter your question">
      <button class="buttontest" onclick="sendQuestion()">Submit</button>
    </div>
    <div class="npc-portrait">
      <img src="static\12.png" alt="NPC Portrait" id="npcPortrait" width="400%" height="750%">
    </div>
  </div>

  <script>
    function sendQuestion() {
      const questionInput = document.getElementById('questionInput').value;

      const url = "http://localhost:8000/generate_text";
      const payload = {
          question: questionInput
      };

      fetch(url, {
          method: "POST",
          headers: {
              "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
      })
      .then(response => response.json())
      .then(responseData => {
          const answer = responseData.answer;
          const intent = responseData.intent;
          const npcBox = document.getElementById('npcBox');
          const npcintentBox = document.getElementById('npcintentBox')
          
          npcintentBox.innerHTML = intent;

          // Assuming `npcText` is the element displaying your text
          const npcText = document.getElementById("npcText");

          // Function to update and restart animation
          function updateTextWithAnimation(newText) {
            // Temporarily remove the class to reset animation
            npcText.classList.remove("typewriter");

            // Trigger reflow to restart the animation
            void npcText.offsetWidth; // This forces the browser to reflow

            // Re-add the class and set new text
            npcText.classList.add("typewriter");
            npcText.innerHTML = newText;
          }

          // Call this function with the new answer text
          updateTextWithAnimation(answer);
      })
      .catch(error => {
          console.error("Error:", error);
      });
    }
    

  // Function to send a request to the server
  function notifyServer() {
    fetch("http://localhost:8000/page_opened", { //change
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({status: "page_opened"})
    })
    .then(response => response.json())
    .then(data => {
        // Check the 'html_active' status and log the appropriate message // change
        if (data.html_active === "active") {
          console.log(data.message);  // Log "webpage active"
        } else {
          console.log(data.message);  // Log "webpage inactive"
        }
    })
    .catch(error => {
        console.error("Error notifying server:", error);
    });
  }
  function get_npc_distance() {
    fetch("http://localhost:8000/get_npc_location", { //change
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({status: "page_opened"})
    })
    .then(response => response.json())
    .then(data => {
        // Check the 'html_active' status and log the appropriate message // change
        // const message = data.message
        // const npcName = data.npcName
        // const location = data.location
        const distance = data.distance
        console.log(distance)
        const submitButton = document.querySelector('.buttontest');
        if (distance > 100) {
            submitButton.disabled = true; // Disable the button
            console.log("Button locked: Distance is greater than 100.");
        } else {
            submitButton.disabled = false; // Enable the button
            console.log("Button unlocked: Distance is 100 or less.");
        
        } 

         // if (data.html_active === "active") {
          //console.log(data.message);  // Log "webpage active"
        //} else {
          //console.log(data.message);  // Log "webpage inactive" remove later
        //}
        
        //return {"message": "Location received", "npcName": npc_name, "location": location, "distance": distance} equals each

          //const npcintentBox = document.getElementById('npcintentBox')
        
    })
    .catch(error => {
        console.error("Error notifying server:", error);
    });
  }

  // Send the request immediately after the page loads
  window.onload = function() {
    notifyServer();
    get_npc_distance();

    // Check every 3 seconds (3000 milliseconds)
    setInterval(notifyServer, 3000);
    setInterval(get_npc_distance, 3000) 
  };

//here is location
  </script>
</body>
</html>